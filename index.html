<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Chip Counter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        #addPlayer {
            background-color: #4dff4d;
        }
        .white {
            background-color: #ffffff;
            color: black;
            border: 1px solid #ccc;
        }
        .red {
            background-color: #ff4d4d;
        }
        .blue {
            background-color: #4d79ff;
        }
        .green {
            background-color: #4dff4d;
        }
        .update {
            background-color: #add8e6;
        }
        .remove {
            background-color: #ff6666;
        }
        .winner {
            background-color: #ffd700;
            color: black;
        }
        .player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .chip-controls button {
            margin-right: 5px;
        }
        .chip-input {
            width: 70px;
        }
        .player span {
            font-size: 1.2em;
            font-weight: bold;
        }
        .fold {
            margin-left: 10px;
            background-color: #d3d3d3;
            color: black;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            font-size: 1.2em;
            line-height: 1.5;
            word-wrap: break-word;
            white-space: normal;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
        }
        .info-icon {
            cursor: pointer;
            font-size: 3em;
            position: fixed;
            top: 20px;
            right: 40px;
            color: #fff;
            background-color: #000;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .game-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            font-size: 0.9em;
            z-index: 1000;
        }
        .game-history h3 {
            margin-top: 0;
        }
        .round {
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Poker Chip Counter</h1>

        <table>
            <tr>
                <td><label for="playerName">Player Name:</label></td>
                <td><input type="text" id="playerName" placeholder="Enter player name"></td>
            </tr>
            <tr>
                <td><label for="chipCount">Initial Chips:</label></td>
                <td><input type="number" id="chipCount" placeholder="Enter initial chip count"></td>
            </tr>
            <tr>
                <td colspan="2">
                    <button id="addPlayer">Add Player</button>
                </td>
            </tr>
        </table>

        <h2>Players</h2>
        <div id="playerList"></div>

        <h2>Game Actions</h2>
        <table>
            <tr>
                <td><label for="betAmount">Bet Amount (Per Player):</label></td>
                <td><input type="number" id="betAmount" placeholder="Enter bet amount"></td>
            </tr>
            <tr>
                <td><label for="winnerSelect">Select Winner:</label></td>
                <td>
                    <select id="winnerSelect">
                        <option value="">--Select Winner--</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <button class="winner" id="declareWinner">Declare Winner</button>
                    <button class="undo" id="undoAction">Undo</button>
                </td>
            </tr>
        </table>
    </div>

    <span class="info-icon" onclick="showInfo()">i</span>

    <!-- Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <span class="close" onclick="closeInfo()">&times;</span>
            <h2>How to Use the Poker Chip Counter</h2>
            <pre id="instructionText"></pre>
        </div>
    </div>

    <div class="game-history" id="gameHistory">
        <h3>Game History</h3>
    </div>

    <script>
        const playerList = document.getElementById('playerList');
        const playerNameInput = document.getElementById('playerName');
        const chipCountInput = document.getElementById('chipCount');
        const addPlayerButton = document.getElementById('addPlayer');
        const declareWinnerButton = document.getElementById('declareWinner');
        const betAmountInput = document.getElementById('betAmount');
        const winnerSelect = document.getElementById('winnerSelect');
        const undoButton = document.getElementById('undoAction');

        let players = [];
        const chipValues = {
            white: 1,
            red: 5,
            blue: 10,
            green: 25
        };
        const actionHistory = [];

        function renderPlayers() {
            playerList.innerHTML = '';
            winnerSelect.innerHTML = '<option value="">--Select Winner--</option>';

            players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                playerDiv.innerHTML = `
                    <span>${player.name}: ${player.chips} chips (${player.folded ? 'Folded' : 'Active'})</span>
                    <div class="chip-controls">
                        <input type="number" class="chip-input" id="chipChange${index}" placeholder="Change amount">
                        <button class="update" onclick="updateChips(${index})">Update</button>
                        <button class="remove" onclick="removePlayer(${index})">Remove</button>
                        <button class="fold" onclick="toggleFold(${index})">${player.folded ? 'Unfold' : 'Fold'}</button>
                    </div>
                    <div>
                        <button class="white" onclick="addChips(${index}, 'white')">+1</button>
                        <button class="red" onclick="addChips(${index}, 'red')">+5</button>
                        <button class="blue" onclick="addChips(${index}, 'blue')">+10</button>
                        <button class="green" onclick="addChips(${index}, 'green')">+25</button>
                    </div>
                `;
                playerList.appendChild(playerDiv);

                const option = document.createElement('option');
                option.value = index;
                option.textContent = player.name;
                winnerSelect.appendChild(option);
            });
        }

        function addPlayer() {
            const name = playerNameInput.value.trim();
            const chips = parseInt(chipCountInput.value, 10);

            if (name && !isNaN(chips)) {
                players.push({ name, chips, folded: false, foldAmount: 0 });
                actionHistory.push({ type: 'addPlayer' });
                playerNameInput.value = '';
                chipCountInput.value = '';
                renderPlayers();
            } else {
                alert('Please enter a valid name and chip count.');
            }
        }

        function updateChips(index) {
            const chipInput = document.getElementById(`chipChange${index}`);
            const chipChange = parseInt(chipInput.value, 10);

            if (!isNaN(chipChange)) {
                const prevChips = players[index].chips;
                players[index].chips = chipChange;
                actionHistory.push({ type: 'updateChips', index, prevChips });
                renderPlayers();
            } else {
                alert('Please enter a valid number.');
            }
        }

        function addChips(index, chipType) {
            const prevChips = players[index].chips;
            players[index].chips += chipValues[chipType];
            actionHistory.push({ type: 'addChips', index, prevChips });
            renderPlayers();
        }

        function removePlayer(index) {
            const player = players.splice(index, 1)[0];
            actionHistory.push({ type: 'removePlayer', player });
            renderPlayers();
        }

        function toggleFold(index) {
            const player = players[index];

            const prevFolded = player.folded;
            const prevFoldAmount = player.foldAmount;

            if (player.folded) {
                player.folded = false;
                player.foldAmount = 0;
            } else {
                player.folded = true;
                player.foldAmount = player.chips;
                player.chips = 0;
            }

            actionHistory.push({
                type: 'toggleFold',
                index,
                prevFolded,
                prevFoldAmount
            });

            renderPlayers();
        }

        function declareWinner() {
            const winnerIndex = winnerSelect.value;
            const betAmount = parseInt(betAmountInput.value, 10);

            if (winnerIndex !== '' && !isNaN(betAmount)) {
                const winner = players[winnerIndex];
                winner.chips += betAmount;
                actionHistory.push({ type: 'declareWinner', winnerIndex, betAmount });
                renderPlayers();
                updateGameHistory(winner.name, 'Won', betAmount);
            } else {
                alert('Please select a winner and enter a valid bet amount.');
            }
        }

        function undoLastAction() {
            if (actionHistory.length === 0) return;

            const lastAction = actionHistory.pop();

            switch (lastAction.type) {
                case 'addPlayer':
                    players.pop();
                    break;
                case 'updateChips':
                    players[lastAction.index].chips = lastAction.prevChips;
                    break;
                case 'addChips':
                    players[lastAction.index].chips = lastAction.prevChips;
                    break;
                case 'removePlayer':
                    players.push(lastAction.player);
                    break;
                case 'toggleFold':
                    const player = players[lastAction.index];
                    player.folded = lastAction.prevFolded;
                    player.foldAmount = lastAction.prevFoldAmount;
                    break;
                case 'declareWinner':
                    players[lastAction.winnerIndex].chips -= lastAction.betAmount;
                    break;
            }

            renderPlayers();
        }

        function updateGameHistory(playerName, action, amount) {
            const gameHistoryDiv = document.getElementById('gameHistory');
            const roundDiv = document.createElement('div');
            roundDiv.classList.add('round');
            roundDiv.innerHTML = `${playerName} ${action} ${amount} chips.`;
            gameHistoryDiv.appendChild(roundDiv);
        }

        function showInfo() {
            const modal = document.getElementById('infoModal');
            modal.style.display = 'flex';
            document.getElementById('instructionText').textContent = `
                1. Add players by entering their name and initial chip count.
                2. Use the buttons to add chips (1, 5, 10, or 25 chips).
                3. Players can fold, and their chips will be set to 0.
                4. Declare a winner by selecting the winner and entering the bet amount.
                5. You can undo the last action.
            `;
        }

        function closeInfo() {
            const modal = document.getElementById('infoModal');
            modal.style.display = 'none';
        }

        addPlayerButton.addEventListener('click', addPlayer);
        declareWinnerButton.addEventListener('click', declareWinner);
        undoButton.addEventListener('click', undoLastAction);
    </script>
</body>
</html>
